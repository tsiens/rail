{% extends 'template.html' %}
{% block content %}
    <div id="nav">
        <label>
            <select class="form-control" v-model="city[0]" :disabled="disabled[0]" style="width:200px">
                <option>全国</option>
                <template v-if="!disabled[0]">
                    <option v-for="v,k in data">[[ k ]]</option>
                </template>
            </select>
        </label>
        <label>
            <select class="form-control" v-model="city[1]" :disabled="disabled[1]||(city[0]=='全国'&&!disabled[0])"
                    style="width:200px">
                <option v-if="city[0]=='全国'">全国</option>
                <option v-else>[[ city[0] ]]</option>
                <template v-if="!disabled[0]">
                    <option v-for="v,k in data[city[0]]">[[ k ]]</option>
                </template>
                <template v-else>
                    <option v-for="v,k in data">[[ k ]]</option>
                </template>
            </select>
        </label>
        <br/>
        [[ city ]]
        <br/>
        [[ disabled ]]
        <br/>
        [[ data ]]
    </div>
    <div id="treemap" class="echarts" style="flex:1"></div>
{% endblock %}
<script>
    {% block script %}
        $("a:contains('城市')").addClass('active');
        $("title").text('全国');
        var nav = new Vue({
            el: '#nav',
            mounted: function () {
                setTimeout(this.post, 0)
            },
            data: {
                city: ['全国', '全国'],
                disabled: [true, false],
                citys: {},
                show: []
            },
            computed: {
                data: function () {
                    return this.format(this.citys, 0);
                }
            },
            methods: {
                format: function (old_data, n) {
                    var _this = this;
                    if (n === 2) {
                        return old_data
                    }
                    var new_data = {};
                    $.each(old_data, function (k, v) {
                        var data = _this.format(v, n + 1);
                        if (_this.disabled[n]) {
                            $.each(data, function (k, v) {
                                new_data[k] = v
                            })
                        }
                        else {
                            new_data[k] = data
                        }
                    });
                    return new_data
                },
                post: function () {
                    var _this = this;
                    $.post('{% url 'data' %}', {'type': 'city'}, function (res) {
                        loading.hide();
                        _this.citys = res;
                    });
                }
            }
        });
    {% endblock %}
</script>