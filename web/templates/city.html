{% extends 'template.html' %}
{% block content %}
    <div id="nav" style="text-align: left">
        <label>
            <select class="form-control" v-model="city[0]" style="width:200px">
                <option>全国</option>
                <option>跨省</option>
                <option v-for="s in data.省">[[ s ]]</option>
            </select>
        </label>
        <label>
            <select class="form-control" v-model="city[1]" :disabled="city[0]=='全国'||data[city[0]].length==0"
                    style="width:200px">
                <option v-if="city[0]!='全国'&&data[city[0]].length>1">[[ city[0] ]]</option>
                <option v-for="d in data[city[0]]">[[ d ]]</option>
            </select>
        </label>
        <br/>
        [[ city ]]
        <br/>
        [[ data ]]
    </div>
    <div id="treemap" class="echarts" style="flex:1"></div>
{% endblock %}
<script>
    {% block script %}
        $("a:contains('城市')").addClass('active');
        $("title").text('全国', -1);
        var nav = new Vue({
            el: '#nav',
            mounted: function () {
                var _this = this;
                setTimeout(function () {
                    _this.post('省')
                }, 0)
            },
            data: {
                city: ['全国', '无'],
                data: {'全国': []}
            },
            watch: {
                'city.0': function (city0) {
                    this.post(city0, 0);
                    this.city[1] = city0
                },
                data: function (n, o) {
                    console.log(n, o)
                }
            },
            methods: {
                post: function (data, n) {
                    var _this = this;
                    if (!_this.data[data]) {
                        _this.data[data] = [];
                        $.post('{% url 'data' %}', {'type': 'city', 'data': data}, function (res) {
                            loading.hide();
                            _this.data[data] = res;
                            if ((n === 1) && res.length === 1) {
                                _this.city[1] = res[0]
                            }
                            _this.$forceUpdate()
                        });
                    }
                }
            }
        });
    {% endblock %}
</script>